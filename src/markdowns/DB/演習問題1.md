# DB_演習問題1

---

## 演習問題-SQL1-基本

---

学生と専攻を表すテーブルを作成し、登録、検索、更新、削除の操作を行います。

テーブル構成のイメージ

<学生>

|student_id|student_name|grade|hometown|major_id|
|----------|------------|-----|--------|--------|
|1|山田|1|宮城|1|
|2|田中|1|東京|2|

<専攻>

|major_id|major_name|
|--------|----------|
|1|英文学|
|2|応用科学|

※学生テーブルと専攻テーブルはmajor_idで紐づいている。

例) 山田の専攻は"英文学"

### 作成するSQL

下記に記載されている操作を行うためのSQL分を作成し、実行してください。

"db_exam1.sql"というテキストファイルを作成し、使用するSQL分を全て記載して提出してください。

### 1. データベース作成  

"db_exam"という名前のデータベースを作成してください

### 2. テーブル作成-その1

"major"という名前のテーブルを作成してください。カラム情報は下記の通りです。

("説明"はカラムに対する説明のため、SQL作成には関係ありません)  

|カラム名|型|制約|説明|
|--------|--|----|----|
|major_id|INT|PRIMARY KEY|主キー|
|major_name|VARCHAR(50)| |専攻名|

### 3. テーブル作成-その2

"student"という名前のテーブルを作成してください。カラム情報は下記の通りです。

("説明"はカラムに対する説明のため、SQL作成には関係ありません)  

|カラム名|型|制約|説明|
|--------|--|----|----|
|student_id|INT|PRIMARY KEY|主キー|
|student_name|VARCHAR(50)||学生の氏名|
|grade|INT||学年|
|hometown|VARCHAR(50)||出身|
|major_id|INT|NOT NULL  , REFERENCES major(major_id)|専攻(majorテーブルのmajor_idと紐づく)|

### 4. "major"テーブルへデータ登録  

"major"テーブルへ下記データを登録してください

|major_id|major_name|
|--------|----------|
|1|英文学|
|2|応用科学|
|3|情報工学|
|4|経済学|
|5|国際文化|

### 5. "student"テーブルへデータ登録  

"student"テーブルへ下記データを登録してください

|student_id|student_name|grade|hometown|major_id|
|----------|------------|-----|--------|--------|
|1|山田|1|宮城|1|
|2|田中|1|東京|2|
|3|佐藤|1|東京|3|
|4|鈴木|2|鹿児島|1|
|5|高橋|2|北海道|2|
|6|吉田|2|東京|1|
|7|伊藤|3|鹿児島|2|
|8|山本|3|神奈川|3|
|9|森本|4|沖縄|4|
|10|吉岡|4|神奈川|5|

### 6. studentテーブル検索-その1

studentテーブルに対して、gradeが1のレコードを取得してください  

<実行結果イメージ>  
|student_id|student_name|grade|hometown|major_id|
|----------|------------|-----|--------|--------|
|1|山田|1|宮城|1|
|2|田中|1|東京|2|
|3|佐藤|1|東京|3|

### 7. studentテーブル検索-その2  

studentテーブルに対して、hometownが"東京"のレコードを取得してください  

<実行結果イメージ>  
|student_id|student_name|grade|hometown|major_id|
|----------|------------|-----|--------|--------|
|2|田中|1|東京|2|
|3|佐藤|1|東京|3|
|6|吉田|2|東京|1|

### 8. majorテーブル検索  

majorテーブル全レコードのmajor_nameのみを取得してください  

<実行結果イメージ>  
|major_name|
|:--:|
|英文学|
|応用科学|
|情報工学|
|経済学|
|国際文化|

### 9. studentテーブルのレコード更新  

studentテーブルに対して、student_idが10のレコードのgradeを3へ更新してください  

### 10. studentテーブルのレコード削除  

studentテーブルに対して、student_idが10のレコードを削除してください

### 補足

* 出力順は、実行結果イメージと異なっても良いです。
* INSERT分について  
  一度のSQL分で複数のデータを登録することができます。

``` sql
INSERT INTO テーブル名 
(カラム名1, カラム名2, ...) VALUES  -- テーブル名とVALUESの間のカラム名は挿入先のテーブルのカラム名。省略可能。

(カラム名1の値, カラム名2の値, ...)
,(カラム名1の値, カラム名2の値, ...)
,......   ;
```

**使用例**

```sql
INSERT INTO users VALUES 
(2, 'techno', '0571112222'), (3, 'core', '09012345678');
```

この場合、usersテーブルに2件のデータを登録することができます。

(下記のSQL分と実行結果は同じです。)

```sql
INSERT INTO users VALUES (2, 'techno', '0571112222');
INSERT INTO users VALUES (3, 'core', '09012345678');
```

* コメントについて  
データベースには、コメントという機能があります。

コメントにすることで、SQL文として実行されないようになります。

<単一行コメント>  
「--」から行末までに記述した内容がコメントになります。

```sql
-- データ抽出
SELECT * FROM users;
```

<複数行コメント>  
「\/\*」から「\*/」までに記述した内容がコメントになります。

```sql
/*
  データ抽出
  (users用)
*/
SELECT * FROM users;
```

---

## 演習問題-SQL1-発展

---

売上と顧客と表すテーブルを作成し、登録、検索、更新、削除の操作を行います。

### テーブル構成のイメージ

<売上>

|sales_id|order_date|customer_id|amount|
|--------|----------|-----------|------|
|1|2018/11/01|1|30000|
|1|2018/10/01|3|5000|

<顧客>

|customer_id|customer_name|
|-----------|-------------|
|1|田中|
|2|鈴木|

※売上テーブルと顧客テーブルはcustomer_idで紐づいている  
例) sales_idが1の売上は田中さんからの売上

### 作成するSQL

下記に記載されている操作を行うためのSQL分を作成し、実行してください。

"db_exam_dev1.sql"というテキストファイルを作成し、使用するSQL分を全て記載して提出してください。

### 1. データベース作成  

"axiz_exam_dev"という名前のデータベースを作成してください

### 2. テーブル作成-その1  

"customer"という名前のテーブルを作成してください。カラム情報は下記の通りです  
("説明"はカラムに対する説明のため、SQL作成には関係ありません)  

|カラム名|型|制約|説明|
|-------|--|----|----|
|customer_id|INT|PRIMARY KEY|顧客ID(管理番号)  主キー|
|customer_name|VARCHAR(50)||顧客名|

### 3. テーブル作成-その2  

"sales"という名前のテーブルを作成してください。カラム情報は下記のとおりです。

("説明"はカラムに対する説明のため、SQL作成には関係ありません)

|カラム名|型|制約|説明|
|-------|--|----|----|
|sales_id|INT|PRIMARY KEY|売上ID(管理番号)  主キー|
|order_date|DATE||注文日|
|customer_id|INT|NOT NULL  REFERENCES customer(customer_id)|顧客ID(customerテーブルのcustomer_idと紐づく)|
|amount|DECIMAL||売上金額|

### 4. "customer"テーブルへデータ登録  

下記データを登録してください。

|customer_id|customer_name|
|-----------|-------------|
|1|田中|
|2|鈴木|
|3|田中|
|4|田島|

### 5. "sales"テーブルへデータ登録  

下記データを登録してください。

|sales_id|order_date|customer_id|amount|
|--------|----------|-----------|------|
|1|2018/11/01|1|3000|
|2|2018/10/01|3|5000|
|3|2018/10/01|4|6000|
|4|2018/11/02|2|2000|
|5|2018/11/15|2|NULL|

※値をNULLにするには、セットする値にNULLと記述するか、値そのものをセットしない。

### 6. salesテーブル検索-その1　　

salesテーブルに対して、amountが5000よりも小さいレコードを取得してください。

<実行結果イメージ>  
|sales_id|order_date|customer_id|amount|
|--------|----------|-----------|------|
|1|2018/11/01|1|3000|
|4|2018/11/02|2|2000|

### 7. salesテーブル検索-その2  

salesテーブルに対して、amountが5000以上のレコードを取得してください。

<実行結果イメージ>  
|sales_id|order_date|customer_id|amount|
|--------|----------|-----------|------|
|2|2018/10/01|3|5000|
|3|2018/10/01|4|6000|

### 8. salesテーブル検索-その3  

salesテーブルに対して、全てのカラムと、amountに「1.1」を掛けたカラムを取得してください。

※カラムに数値を掛ける方法は補足説明を参考にしてください。

<実行結果イメージ>  
|sales_id|order_date|customer_id|amount|カラム名なし|
|--------|----------|-----------|------|--|
|1|2018/11/01|1|3000|3300|
|2|2018/10/01|3|5000|5500|
|3|2018/10/01|4|6000|6600|
|4|2018/11/02|2|2000|2200|
|5|2018/11/15|2|NULL|NULL|

### 9. salesテーブル検索-その4  

salesテーブルに対して、amountが「NULL」でないレコードを取得してください。

※NULLではないという判定方法は補足説明を参考にしてください。

<実行結果イメージ>  
|sales_id|order_date|customer_id|amount|
|--------|----------|-----------|------|
|1|2018/11/01|1|3000|
|2|2018/10/01|3|5000|
|3|2018/10/01|4|6000|
|4|2018/11/02|2|2000|

### 10. customerテーブル検索-その1  

customerテーブルに対して、customer_nameが"田中"ではないレコードを取得してください。　　
※右辺と左辺が等しくないという判定方法は補足説明を参考にしてください。

<実行結果イメージ>  
|customer_id|customer_name|
|-----------|-------------|
|2|鈴木|
|4|田島|

### 11. salesテーブルのレコード更新  

salesテーブルに対して、sales_idが4のレコードの、order_dateを'2018/11/05'へ、customer_idを4へ更新してください。

### 12. salesテーブルのレコード削除  

salesテーブルに対して、amountが「NULL」のレコードを削除してください。

### 補足

* 出力順は、実行結果イメージと異なっても良いです。
* 比較演算子について  
PostgreSQLでは、代表的な比較演算子には下記があります。

|演算子|説明|使用例|
|------|----|------|
|<|小さい|カラム名 < 5000|
|>|大きい|カラム名 > 5000|
|<=|以下|カラム名 <= 5000|
|>=|以上|カラム名 >= 5000|
|=|等しい|カラム名 = 5000|
|<>  !=|等しくない|カラム名 <> 5000    カラム名 != 5000|
|IS NULL|値がNULL|カラム名 IS NULL|
|IS NUT NULL|値がNULLではない|カラム名 IS NOT NULL|

※「!=」演算子は、左辺と右辺が等しくないことを判定できますが、postgreSQL以外のデータベースでは使えないこともあるので、「<>」で覚えた方がいいです。(こちらが一般的です)  

* 算術演算子について  
postgreSQLでは、代表的な算術演算子には下記があります。

|演算子|説明|
|------|----|
|+|足し算を行う|
|-|引き算を行う|
|*|掛け算を行う|
|/|割り算を行う|
|%|剰余(割ったあまり)を求める|

また、カラムに対して演算を行うこともできます。

<使用例>  

``` sql
SELECT amount, amount + 1000 FROM sales WHERE sales_id = 1;
```

この場合、以下の結果になります。
|amount|カラム名なし|
|-----|-------------|
|3000|4000|

amountカラムの値(3000) + 1000 = 4000の値を求められる。

また、カラムの値を計算に使用しただけなので、表示されるときのカラム名はなしになります。

# Linux基礎

---

## Linuxとは

* Linuxはサーバーや組み込み用のコンピュータなどで利用されてるOSの1つです。
* リーナス・トーバルズによって開発されました。
* UNIXというOSを真似て作られており、UNIXライクなOSとも呼ばれます。

---

## Linuxの特徴

**CUI操作**

LinuxはWindowsやMacの様にGUIによる操作も可能ですが、コマンドによるCUIの操作が主流です。


**オープンソース**

Linuxはオープンソースと呼ばれ、以下のような特徴があります。

* プログラムを実行する自由
* ソースの改変の自由
* 利用・再配布の自由
* 改良したプログラムをリリースする権利

---

### ディストリビューション

Linuxは狭義にはカーネルと呼ばれるOSの核の部分のことを指します。

しかし、実際にLinuxをサーバーOSとして使用するためには、様々なソフトウェアをインストールする必要があります。

カーネルだけの状態から様々なソフトウェアをインストールして環境を構築していくのは簡単ではありません。

その問題を解決するために、多くの企業や団体があらかじめよく使用されるソフトウェアをインストールして使いやすくまとめられた状態でLinuxを配布しています。

このようにして配布されたものをLinuxのディストリビューションと呼びます。


Linuxディストリビューションは数多く存在しますが、よく使用されているものは大きく2つの系統に分かれます。


* RedHat系
  * RedHat Enterprise Linux
  * CentOS
  * Fedora

* Debian系
  * Ubuntu

---

### CUI操作による利点

Linuxでは多くの場合CUIによる操作が行われます。
なぜわざわざCUIを使うのでしょうか。

CUIを使う利点として以下のようなものがあります。


* 画面描写に使用するリソース(ハードウェアの資源)が少なくて済む。（サーバーとしての処理にリソースを割ける）
* コマンドの方が便利な場合がある

---

**画面描写にリソースを割かなくて済む**

WindowsやMacは、GUIによる操作が可能なため、PCにあまり詳しくない人でも直観的な操作が可能です。

しかし、GUIの処理ではメモリやCPUといったリソースを多く使用します。

CUIのみの操作にすれば、直観的な操作はできなくなりますが、その分サーバーとしての本来の処理（リクエストを受けて処理してレスポンスを返す）にリソースを割くことができます。


---

**コマンドの方が便利な場合がある**

例えば「001」から「100」までの連番でフォルダを100個作成したい場合、どのようにすれば効率よく作成することができるでしょうか。

Windowsの場合、フォルダの作成はマウス操作で行うことができますが、100個作るとなると時間がかかります。

Linuxの場合

```bash
mkdir {001..100}
```

とコマンドを1行入力することで実行可能です。

このように、コマンドによる操作の方が効率よく作業が行える場合もあります。


---

**Linux操作**

コマンドを使ったLinuxの操作方法を説明します。

手順書を元に、仮想マシンに接続してください。


---

## Linuxコマンド

### 基本コマンド

* pwd
  * point working directoryの略
  * カレントディレクトリ(現在の作業場所)の確認

* ls [対象のディレクトリ名]
  * listの略
  * 対象のディレクトリの中にあるファイルやフォルダの一覧の確認
  * 対象のディレクトリ名を指定しなかった場合、カレントディレクトリの中身を確認する

* ls -la
  * -を付けることでそのコマンドに対してオプションを付けることができる
  * lを付けると、ファイルの権限や所有者、更新日などの情報を見ることができる
  * aを付けると、隠しファイル（.から始まるファイル）も表示させることができる

* cd [移動先のパス]
  * change directoryの略
  * カレントディレクトリを移動する
  * 相対パスと絶対パスによる指定が可能
  * 移動先を指定しなかった場合には、ユーザーのホームディレクトリに移動する

* echo [文字列]
  * 文字列を標準出力する
  * 文字列はダブルクォーテーションでくくる

---

### ディレクトリ操作コマンド

ディレクトリとはWindowsでいうところのフォルダと同じです。

Linuxではフォルダのことをディレクトリと呼びます。


* mkdir [作成するディレクトリ名]
  * make directoryの略
  * ディレクトリを作成するコマンド

* rmdir [削除するディレクトリ名]
  * remove directoryの略
  * ディレクトリを削除するコマンド
  * ただし空のディレクトリしか削除できないことに注意
  * 中身があるディレクトリはrmコマンドで削除する

---

### ファイル操作コマンド

* touch [ファイル名]
  * ファイルの更新日時を更新する
  * ファイルが存在しなければ、中身が空のファイルが作成される

* cp [コピー元] [コピー先]
  * copyの略
  * ファイルやディレクトリをコピーするコマンド
  * ディレクトリの中身ごとコピーする場合は「-r」のオプションを付ける

* mv [移動元のファイル名やディレクトリ名] [移動先のパス]
  * moveの略
  * ファイルやディレクトリを移動するコマンド
  * 移動先がディレクトリの場合はファイルの移動になる
  * 移動先にファイル名を指定した場合はファイルがリネームされる

* rm [削除対象のファイルやディレクトリ名]
  * removeの略
  * ファイルやフォルダを削除するコマンド
  * 半角スペース区切りでファイルを複数指定することも可能
  * ディレクトリを中身も含めて丸ごと削除するには「-r」のオプションを付ける

---

### ファイル参照のためのコマンド

* cat [ファイル名]
  * catenateの略
  * ファイルの中身を参照する

* less [ファイル名]
  * 1ページ分のファイルを表示する

* head [ファイル名]
  * ファイルの先頭を表示

* tail [ファイル名]
  * ファイルの末尾を表示

---

### 検索で使用するコマンド

* grep [検索する文字列] [検索対象のファイル]
  * 対象のファイルから、特定の文字列を検索するコマンド

* find
  * ディレクトリの中からファイルを検索するコマンド
  * 様々なオプションがある
  * ファイル名から検索する場合は
  find /[検索するディレクトリ] –name [検索キーワード]

---

## Linuxコマンド練習

---

### ディレクトリ構成

ディレクトリ構成とホームディレクトリ(ログインした際の最初の位置)について説明します。

```text
/  ：ルートディレクトリ（最上階層）
|-root  ：ルートユーザーのホームディレクトリ
|-etc   ：アプリケーションなどの設定ファイルがある
|-home  ：書くユーザーのホームディレクトリが格納されている
|-bin   ：基本コマンドが多数格納されている
|-usr   ：一般的なアプリケーションが格納されている
|-var   ：システムのログファイルなど、頻繁に書き換わるファイルが置かれる
```

---

**pwdコマンド**

pwdコマンドを入力してカレントディレクトリを確認して下さい。

```bash
pwd
```

結果
※ログインしたユーザー、環境によって異なります

```text
/root  
```

---

**lsコマンド**

lsコマンドを入力して、カレントディレクトリにあるファイルの一覧の確認をしてください。

```bash
ls
```

結果
※カレントディレクトリによって異なります。

```text
anaconda-ks.cfg
```

---

**mkdirコマンド**

mkdirコマンドでカレントディレクトリに「dir1」ディレクトリを作成してください。

```bash
mkdir dir1
```

lsコマンドを入力して一覧を確認します。

```text
anaconda-ks.cfg  dir1
```

---

**cdコマンド**

cdコマンドを入力してカレントディレクトリを確認します。

```bash
cd dir1
```

pwdコマンドを入力してカレントディレクトリを確認します。

```bash
pwd
```

結果

```text
/root/dir1
```

---

**touchコマンド**

touchコマンドを入力してfile1.txtを作成します。

```bash
touch file1.txt
```

lsコマンドを使用して作成したファイルがあることを確認します。

```bash
ls
```

結果

```text
file1.txt
```

現在のディレクトリ構成は以下のようになっています。

```text
/
|-root
   |-anaconda-ks.cfg
   |-dir1
      |-file1.txt
```

---

**rmコマンド**

rmコマンドを入力して、file1.txtを削除してください。

```bash
rm file1.txt
rm: 通常ファイル 'dir1/anaconda-ks.cfg'を削除しますか? yes
```

lsコマンドを入力して、ファイルが削除されたことを確認してください。

```bash
ls
```

結果

何も表示されない

---

**cdコマンド**

cdコマンドでrootディレクトリに戻ります。
相対パスで指定する方法と絶対パスで指定する方法があります。

相対パスの場合

```bash
cd ..
```

絶対パスの場合

```bash
cd /root
```

---

**cpコマンド**

cpコマンドでanaconda-ks.cfgをdir1ディレクトリにコピーします。

```bash
cp anaconda-ks.cfg dir1
```

lsコマンドでファイルが作られたことを確認します。

```bash
ls dir1
```

結果

```text
anaconda-ks.cfg dir1
```

---

**rmコマンド**

rmコマンドでdir1内のanaconda-ks.cfgを削除します。

```bash
rm dir1/ anaconda-ks.cfg
rm: 通常ファイル 'dir1/anaconda-ks.cfg'を削除しますか? yes
```

---

**rmdirコマンド**

rmdirコマンドを入力してdir1ディレクトリを削除します。

```bash
rmdir dir1
```

lsコマンドで最初の状態に戻ったことを確認します。

```text
/
|-root
   |-anaconda-ks.cfg
```

---

## Linuxコマンド補足

---

**その他のコマンド**

Linuxで使用できるコマンドには他にも様々なコマンドが存在します。
また、コマンドのオプションもごく一部しか紹介していません。
あとは目的に応じて適宜調べながら使えるようにしましょう。

---

**タブキーによる補完とコマンドの履歴**

コマンド操作を効率よく行うために欠かせない操作を紹介します。

* tabキー
  * コマンドを途中まで入力した状態でtabキーを押すと
残り部分を補完してくれる

* 上下キー
  * 上下キーで過去に入力したコマンドの履歴をたどることができる

---

## リダイレクトとパイプ

### リダイレクト

リダイレクトはコマンドの入出力をファイルに切り替えることができる機能です。
通常、コマンドはキーボードで入力し、結果は画面上に表示されます。
リダイレクトを使用することで、コマンドの実行結果をファイルに出力したり、あらかじめ用意しておいたファイルの内容をコマンドの入力として利用することができます。

---

### リダイレクトの種類

出力のリダイレクト

```bash
>
```

出力をファイルに追記

```bash
>>
```

入力のリダイレクト

```bash
<　  
```

入力終端文字の指定

```bash
<<
```

エラー出力をファイルの出力

```bash
2>
```

標準出力とエラー出力をファイルに出力

```bash
2>&1
```

---

### リダイレクトの書式

コマンドの標準出力をファイルに書き込む

```bash
コマンド > ファイル
```

コマンドの標準出力をファイルに追記

```bash
コマンド >> ファイル
```

ファイルの内容を標準入力へ送る

```bash
コマンド < ファイル
```

ファイルにエラー出力を書き込む

```bash
コマンド 2> ファイル
```

ファイルに標準出力とエラー出力を書き込む

```bash
コマンド > ファイル 2>&1
```

---

### リダイレクトの例

ls –laコマンドの結果をlist.txtに書き込む

```bash
ls -la > list.txt
```

ls –laコマンドの結果をlist.txtの末尾に書き込む

```bash
ls -la >> list.txt
```

Helloという文字列をhello.txtに書き込む

```bash
echo "Hello" > hello.txt
```

cmd.txtに書き込まれたコマンドを実行する

```bash
bash < cmd.txt
```

---

### パイプ

パイプは複数のコマンドを組み合わせることができる機能です。
「|」の記号を使用します。

パイプの例

```bash
ls –la | grep "html"
```

ls –la のファイル抽出とgrepの文字列検索を組み合わせることで、"html"という文字列が含まれる名前のファイルのみが表示される。

---

**リダイレクトとパイプ-練習**

---

事前にcdコマンドでユーザーのホームディレクトリに移動してください。

```bash
cd
```

---

**リダイレクト**

echoコマンドとリダイレクトを使って、テキストファイルの中に文字列を追加します。

```bash
echo "message1" > redirect.txt
```

catコマンドでテキストファイルの中身を確認します。

```bash
cat redirect.txt
```

結果

```text
message1
```

---

**リダイレクト追記**

echoでさらに文字列を追記します。

```bash
echo "message2" >> redirect.txt
```

catコマンドでテキストファイルの中身を確認します。

```bash
cat redirect.txt
```

結果

```text
message1
message2
```

---

**コマンドの結果を書き込む**

touchコマンドでファイルを作成しておきます。

```bash
touch redirect_test.txt
```

リダイレクトを使って、ls -lコマンドの結果を書き込みます。

```bash
ls -l > list.txt
```

catコマンドで中身を確認します。

```bash
cat list.txt
```

結果

```text
合計 8
-rw-------. root root 1197 9月 16 21:57 anaconda-ks.cfg
-rw-r--r--. root root    0 9月 23 20:43 list.txt
-rw-r--r--. root root   18 9月 23 06:37 redirect.txt
-rw-r--r--. root root    0 9月 23 07:14 redirect_test.txt
```

---

パイプを使ってlsの結果から「redirect」という文字列を含む名前のファイルを表示します。

```bash
ls | grep "redirect"
```

結果

```text
redirect.txt redirect_test.txt
```

---

## vi

---

### viとは

Linuxで使用されるテキストエディターです。
CUI操作を前提としているため、全てキーボードで操作するテキストエディターになります。

* viエディターの起動
  * vi [ファイル名]
  * ファイルが存在しない場合は新規作成、存在する場合は編集として起動します

---

### viのモード

viには4つのモードがあります。viを起動したときにはノーマルモードです。

* ノーマルモード
* 編集モード（インサートモード）
* コマンドモード
* ビジュアルモード

基本は、ノーマルモードでカーソル移動/範囲選択/コピー/ペーストなどの操作をし、編集モードで内容を入力するといった流れになります。

* ノーマルモード ⇒(i) 編集モード
* 編集モード ⇒(esc) ノーマルモード
* ノーマルモード ⇒(:) コマンドモード
* コマンドモード ⇒(esc) ノーマルモード
* ノーマルモード ⇒(v) ヴィジュアルモード
* ヴィジュアルモード ⇒(esc) ノーマルモード

---

### viのモードの説明

* ノーマルモード
  * viを起動したときの状態
  * カーソルの移動やコピー/ペーストなどのコマンドが使える
  * 別のモードからノーマルモードに戻るときにはESCキーを押下する
* 編集モード（インサートモード）
  * ノーマルモードからiを入力することで切り替わる
  * 入力した文字がそのままテキストとして反映される状態
* コマンドモード
  * Exコマンド(コマンドモード時に使用できるコマンド)が使用できる
  * ファイルの保存やviの終了はコマンドモードで行う
* ビジュアルモード
  * ノーマルモードからvを入力することで切り替わる
  * 矢印キーで移動しながら範囲選択をすることができる

---

### viコマンド（Exコマンド)

viにはノーマルモード時に使える様々なコマンドがあります。
ここでは必要最低限の機能を紹介します。

* :w
  * ファイルを保存
* :wq
  * ファイルを保存して終了
* :q!
  * ファイルを保存せず終了
* :行番号
  * 指定した行番号の行に移動

---

### viコマンド（移動）

* gg
  * ファイルの先頭に移動
* G
  * ファイルの末尾に移動
* Ctrl + f, b
  * 次のページ、前のページへ移動

---

### viコマンド（カット、コピー、ペースト）

* x
  * 1文字削除
* dd
  * 1行削除
* yy
  * 1行コピー
* nyy（nは数値）
  * n行コピー

---

### viコマンド（カット、コピー、ペースト）

* p
  * カーソルの文字の次、または次の行にペースト（貼り付け）
* P（Shift + p）
  * カーソルの文字の前、または前の行にペースト（貼り付け）
* u
  * 直前の操作の取り消し

---

### viコマンド（検索）

* /文字列
  * 文字列の検索
* n
  * 次の文字を検索
* N（Shift + n）
  * 前の文字を検索

---

### その他のテキストエディタ

* vim
  * viの機能はそのままに、拡張・発展させた高機能なエディターです
  * 開発現場でviを使用する場合はvimを使用する方が良いでしょう
  * ディストリビューションによってはvimが初めから入っており、viと入力するとvimが起動するものもあります
* Emacs
  * viと並ぶ、Linuxでよく使用されるエディター

---

## vi-練習

---

ファイル作成

cdコマンドを入力してホームディレクトリに移動してください。

```bash
cd
```

viコマンドを使用して新規にテキストファイルを作成します。

```bash
vi text.txt
```

---

下記のように表示され、「text.txt」ファイルを新規作成し、内容が表示されている状態になります。
(新規作成のため、内容はまだ何も表示されていません)
起動時は「ノーマルモード」になっており、カーソルの移動やコピーやペーストなどのコマンドを使うことができます。

```text
~
~
~
~
~
"text.txt" [New File]
```

---

iを入力して、「編集モード」に切り替えてください。
「編集モード」では、内容を入力することができます。
基本的には、キーボードで入力したものがそのまま書き込まれます。
カーソル移動や、delete、backspaceなどは使えますが、コピーやペースト操作などはできません。
(環境やエディターなどによって可能な操作が異なります)

```text
~
~
~
~
~
-- INSERT --
```

---

下記のように文字を入力してください。

```text
Hello
World!


-- INSERT --
```

文字を入力したら「esc」を押して、「ノーマルモード」に切り替えてください。

```text
Hello
World!
```

---

カーソルを移動させ、「World！」という文字が書かれている行にカーソルを合わせてください。

```text
Hello
World!
```

ddを入力し、現在行にある文字を削除してください。

```text
Hello
```

---

:wq を入力し、内容を保存して、viを終了してください。

```text
Hello


:wq
```

cat コマンドでテキストファイルの中身を確認して下さい。

cat text.txt

```text
Hello
```

---

### 補足

viは、モードという概念があるため、慣れるまでは分かりづらいかも知れません。
基本は、編集モードで内容を入力し、ノーマルモードでコピーやファイルを終了するコマンドを入力するといった操作になります。
現在がどのモードが分からなくなった場合は、「esc」を連続で押し、通常モードに戻ってから操作し直すと良いです。

---

## まとめ

ここで紹介したコマンドや機能はほんの一部です。必要に応じて調べて使えるようにしておきましょう。
サーバーの構築ではCUI操作がメインになることが多いです。
サーバー構築以外でも、Gitの操作やDBの操作など、CUIで操作を行う場面は多くあるので、CUI操作にも慣れておきましょう。

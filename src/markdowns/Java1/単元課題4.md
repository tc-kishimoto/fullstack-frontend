# Java 単元課題4

---

## 課題

課題はDBを使用した商品管理を行うWebアプリケーションの作成です。
以下のモックアップを確認してください。

[モックアップ](https://tc-kishimoto.github.io/web-task-mock/index.html)

以下のモックアップに対し、DBとJavaを使用してWebアプリケーションを作成してください。

モックアップのソースコードは以下のリポジトリをクローン（またはフォーク）して自由に使用してください。

[モックアップリポジトリ](https://github.com/tc-kishimoto/web-task-mock)

---

## 提出

課題のソースコードはGitHubで管理します。
自分のアカウントに課題用のリポジトリを新たに作成し、リポジトリのURLを講師、及びアシスタントに通知してください。

提出期限、及びURLの通知方法については各教室の運用ルールに従ってください。

---

## テーブル定義

3つのテーブルを使用します。

* users
* categories
* products

それぞれのテーブルとテストデータを作成するSQL文はモックアップのリポジトリに含まれています。
自由に使用してかまいません。
接続するデータベース名やユーザー名は任意です。
データベースは課題用に適当に新しく作成してもかまいません。

usersテーブル

|論理カラム名|物理カラム名|型|制約|備考|
|:--|:--|:--|:--|:--|
|id|id|serial|primary key|
|ログインid|login_id|varchar(255)|unique, not null||
|パスワード|password|varchar(255)|not null||
|名前|name|varchar(255)|not null|
|権限|role|int|not null|1:管理者、2:一般ユーザー|
|登録日時|created_at|datetime||
|更新日時|created_at|datetime||

categoriesテーブル

|論理カラム名|物理カラム名|型|制約|備考|
|:--|:--|:--|:--|:--|
|id|id|serial|primary key||
|名前|name|varchar(255)|not null|
|登録日時|created_at|datetime||
|更新日時|created_at|datetime||

productsテーブル

|論理カラム名|物理カラム名|型|制約|備考|
|:--|:--|:--|:--|:--|
|id|id|serial|primary key||
|商品id|product_id|varchar(20)|unique, not null||
|カテゴリid|category_id|int|not null|
|名前|name|varchar(255)|not null||
|単価|price|int|||
|画像パス|image_path|varchar(255)|||
|商品詳細|description|varchar(2000)||
|登録日時|created_at|datetime||
|更新日時|created_at|datetime||

---

## 基本課題

基本課題では以下の機能を実装します。

* ログイン
* ログアウト
* 検索
* 並び替え
* 新規登録（画像ファイル以外）
* 更新（画像ファイル以外）
* 削除

---

### ログイン

IDとパスワードからusersテーブルを検索し、ログインを行います。

#### 画面定義

|項目名|項目ID|fromタイプ|初期値|最大桁数|必須|備考|
|:--|:--|:--|:--|:--|:--|:--|
|ログインID|login_id|text||20|〇|
|パスワード|password|password||50|〇|
|ログインボタン||button||||ログイン処理実行|

* ログイン処理
  * 入力されたIDとPASSを、usersテーブルのlogin_idとpasswordで検索し、一致するレコードを取得する
    * レコードが取得できた場合：ユーザー情報をセッションに保存し、メニュー画面に遷移する
    * レコードが取得できない場合：ログイン画面に戻り、「IDまたはパスワードが不正です」のエラーメッセージを表示する
* 必須入力チェック
  * IDが未入力の場合
    * エラーメッセージ「IDは必須です」を表示する
  * PASSが未入力の場合
    * エラーメッセージ「PASSは必須です」を表示する

---

### ヘッダー

ログイン中は、画面右上（ログアウトボタンの左側）にユーザー名を表示されます。
ログイン時にユーザー情報をセッションに保持し、セッション情報をもとに表示させてください。

---

### 検索

キーワードに応じてproductsテーブルから検索結果を表示します。

* 表示
  * カテゴリは、category_idに紐づくcategoriesテーブルのnameを表示する
  * 取得したレコード件数を表示する
* 検索ボタン押下時
  * 未入力時：全レコードを表示する
  * キーワード入力時：商品名、またはカテゴリ名に部分一致したレコードを表示
  * 複数キーワードの入力は対応しなくても良い（余裕があれば対応してみよう）

---

### 並び替え

並び替え項目を選択して検索ボタンを押下することで、指定した並び順にレコードを取得して表示します。

---

### 新規登録画面

新規の商品を登録します。
※画像の登録は基本課題ではスキップしてかまいません。

#### 画面定義

|項目名|項目ID|fromタイプ|初期値|最大桁数|必須|備考|
|:--|:--|:--|:--|:--|:--|:--|
|商品ID|product_id|text||20|〇|
|商品名|name|text||255|〇|
|単価|price|number||7|〇|
|カテゴリ|category_id|select|||〇|categoriesテーブルから値を取得する|
|商品説明|description|textarea||2000|
|画像|img_path|file|||
|登録ボタン||button||||登録処理を実行する|
|戻るボタン||button||||メニュー画面に戻る|

* 必須チェック
  * 必須項目が未入力で登録ボタン押下時は、「<項目名>は必須です」のエラーメッセージを表示する
* 登録ボタン押下時
  * 確認ダイアログを表示し、「登録」が押下された場合は登録処理に進む
  * 「戻る」が押下された場合は確認ダイアログを閉じる
* 戻るボタン押下時
  * メニュー画面に戻る
* 重複チェック
  * 登録時に入力された商品IDのレコードが既に存在する場合、登録画面に戻り、「商品IDが重複しています」のメッセージを表示する
* 登録処理
  * productsテーブルに対して、画面項目に対応する値をセットしてレコードを登録する
  * 登録処理終了後は、「登録が完了しました」のメッセージを表示し、画面の入力値を初期化する

---

### 商品詳細画面

選択された商品の詳細情報を表示します。
初期表示時は全ての入力項目は入力不可とし、参照のみが可能な状態とします。

|項目名|項目ID|fromタイプ|初期値|最大桁数|必須|備考|
|:--|:--|:--|:--|:--|:--|:--|
|商品画像|img_path|imgタグ|products.img_path||||
|商品ID|product_id|text|products.product_id|20|〇|入力不可|
|商品名|name|text|products.name|255|〇|入力不可|
|単価|price|number|products.price|7|〇|入力不可|
|カテゴリ|category_id|select|products.category_id||〇|入力不可、categoriesテーブルから値を取得する|
|商品説明|description|textarea|products.description|2000||入力不可|
|削除ボタン||button||||登録処理を実行する|
|編集ボタン||button||||登録処理を実行する|
|戻るボタン||button||||メニュー画面に戻る|

* 戻るボタン
  * メニュー画面に戻る
* 削除ボタン
  * 確認ダイアログを表示し、削除が押下された場合は、product_idをキーにレコード削除し、メニュー画面に戻り「削除に成功しました」と表示する
  * 削除時にエラーが発生した場合は、詳細画面で「削除に失敗しました」のエラーメッセージを表示する
* 修正ボタン
  * 商品更新画面に遷移する

---

### 更新

既存のproductsレコードの値を更新(update)します。
※画像の更新は基本課題ではスキップしてかまいません。
#### 画面定義

|項目名|項目ID|fromタイプ|初期値|最大桁数|必須|備考|
|:--|:--|:--|:--|:--|:--|:--|
|商品ID|product_id|text|products.product_id|20|〇|
|商品名|name|text|products.name|255|〇|
|単価|price|number|products.price|7|〇|
|カテゴリ|category_id|select|products.category_id||〇|categoriesテーブルから値を取得する|
|商品説明|description|textarea|products.description|2000|
|画像|img_path|file|products.img_path||
|更新ボタン||button||||登録処理を実行する|
|メニューに戻るボタン||button||||メニュー画面に戻る|

* 更新ボタン
  * idをキーに画面に入力された値でproductsレコードを更新する
  * 必須項目が未入力の場合は「<項目>は必須です」のエラーメッセージを表示する
  * 異なるidのレコードでproduct_idが既に存在している場合、「商品IDが重複しています」のエラーメッセージを表示する
  * 更新時にエラーが発生した場合、「更新時にエラーが発生しました」のエラーメッセージを表示する
  * 更新が正常に行われた場合は、メニュー画面に遷移し「更新処理が完了しました」のメッセージを表示する
* メニューに戻る
  * メニュー画面に遷移する

---

### 権限による制御

ログインしたーユーザーの権限(role)によって、使用できる機能を制限します。

* 管理者ユーザー(role=1)の場合、全ての機能が使用可能
* 一般ユーザー(role=2)の場合、参照のみが可能(新規登録・更新・削除はできない)
  * メニュー画面では新規登録ボタンは表示しない
  * 詳細画面では、削除と更新のボタンを表示しない
  * ※CSSによる非表示は行わないこと。ブラウザからソースコードを見たときにボタンの要素が存在しないように制御すること

---

### ログアウト

* ユーザー情報のセッションを破棄し、トップページに戻る

---

## クラス定義

必要に応じてServlet, Service, Entity, Daoのクラスを作成してください。

---

## 発展課題

* 画像ファイルを登録できるようにします。
* JavaScriptを活用し、画面遷移を減らすことを目指します。

### 画像ファイルの登録

新規登録、及び更新画面にて、添付した画像ファイルを登録し、詳細画面で画像が表示されるようにしてください。

画像を保存する方法は一般に２つの方法があります。

1. APサーバーに画像ファイルを保存し、DBでファイルのパスを保持する方法
2. DBに画像のbinary形式のデータを保持する方法

どちらの方法でも構いませんが、一般に1の方法が楽に実現できます。
画像の保存方法やサーブレットでファイルを受け取る方法などはインターネットで検索してかまいません。

### 非同期通信による検索

商品の検索時に画面遷移せずに結果が表示されるようにします。
JavaScriptの非同期通信を使い、検索ボタン押下時に画面遷移せず、検索結果の表のみが更新されるようにしてください。

JavaScriptでの非同期通信を実現するには、Ajax、fetch関数、axiosなどの方法がありますが、どれを使用してもかまいません。
また、フレームワーク・ライブラリも自由に使用してかまいません。

### 並び替え処理の実装

並び替えの処理をJavaScriptを実装します。
プルダウンで並び替え項目が選択したタイミングで画面遷移せず並び替えが実行されるようにしてください。

※JavaScriptのライブラリやフレームワークには以下のようなものがあります。

* jQuery
* Vue.js
* React

等があります。
それぞれCDNを使うことで簡単に導入することが可能です。
興味があれば調べて活用してください。
フレームワークを使用することで検索や並び替えの処理も簡潔に書くことができるようになります。

# 繰り返し

---

## 概要

繰り返しは、同じような処理を何回も繰り返したいときに使用するものです。

繰り返しを実現するための方法として、大きく分けて２つあります。「for文」と「while文」です。

ここではその２つを学んでいきます。

---

## for文

for文とは、制御構文の中での「反復」にあたります。

例えば10円玉が財布に入っている（条件）間は、10円玉を自動販売機に入れる（繰り返す処理）など、同じような動作を繰り返し行いたいときに使用します。


---

for文の構文は以下のようになります。


```text
for (初期化; 条件式; 後処理) {
    繰り返す処理
}
```

* 初期化は処理開始前に「一度だけ実行される処理」です。
* 条件式にはループを続ける条件を書きます。条件式がtrueの間、繰り返しの処理が実行されます。
* 後処理は「繰り返す処理が1回終わるごとに実行される処理」です。

---

if文と同様、処理の中身が1行しかない場合は、{}（中括弧）を省略して書くことが可能です。


```text
for (初期化; 条件式; 後処理) 
    繰り返す処理
```

---

for文を使用したプログラムを確認していきます。

以下のプログラムを確認してください。


```php
<?php
for ($i = 0; $i < 2; $i++) {
    echo "\$iは{$i}です。<br>";
}
```

結果

```text
$iは0です。
$iは1です。
```

---

具体的に、処理を追ってみましょう。

まずは、「初期化」「条件式」「後処理」「繰り返す処理」は、それぞれ以下のようになります。


* 初期化：`$i` = 0 ⇒ 変数`$i`を定義して0を代入
* 条件式：`$i` < 2 ⇒ $iが2より小さい間処理を繰り返す
* 後処理：`$i++` ⇒ 処理が終わるごとに`$i`に1加算する
* 繰り返す処理：`echo "\$iは{$i}です。<br>";` ⇒`$i`の内容を出力

---

処理の流れは以下のようになります。


1. 初期化：`$i`が宣言され、0が代入(`$i`:0)
2. 条件式判定：`$i` < 2 を判定(`$i`は0のためtrueになる)
3. 繰り返す処理：「`$i`は0です。」が出力される
4. 後処理：`$i`に１が加算される(`$i`:1)
5. 条件式判定：`$i` < 2 を判定(`$i`は1のためtrueになる)
6. 繰り返す処理：「`$i`は1です。」が出力される
7. 後処理：`$i`に１が加算される(`$i`:2)
8. 条件式判定：`$i` < 2 を判定(`$i`は2のためfalseになる)
9. 処理終了（条件式がfalseになったので）

最初は複雑に感じるかもしれませんが、練習して徐々に処理を追えるようにしていきましょう。


for文について、もう少し詳しく見ておきましょう。

実は、for文の「初期化」「条件式」「後処理」は省略することができます（もちろん処理も省略できます）。


---

まずは初期化の処理を省略してみます。

```php
<?php 
for (; $i < 2; $i++) {
    echo "\$iは{$i}です。<br>";
}
```

このプログラムでは変数$iが定義されていないため、エラーになります。

変数を先に用意しておくことで、エラーを回避することができます。


```php
<?php
$i = 0;
for (; $i < 2; $i++) {
    echo "\$iは{$i}です。<br>";
}
```

---

続いて「条件式」と「後処理」を省略してみます。


```php
<?php
$i = 0;
for (;;) {
    echo "\$iは{$i}です。<br>";
}
```

結果

```text
$iは0です。
$iは0です。
$iは0です。
$iは0です。
$iは0です。
$iは0です。
$iは0です。
$iは0です。
$iは0です。
$iは0です。
...
```

---

このプログラムを実行すると、以下のような結果になり、出力が止まらなくなります。

なぜこのような結果になったのでしょうか？  

「条件式」に何も書かないとtrueとして扱われます。

そのためfor文が終了せず、ずっと「繰り返す処理」を行い続けていたのです。

このように無限に繰り返す処理を無限ループといいます。

無限ループに入ってしまうと処理が進まなくなってしまいますので、注意が必要です。


※先ほどのプログラムを実行した場合は、Webサーバーを指定するか、ブラウザのタブを閉じてプログラムを終了させてください。

無限ループで処理を続けていると、いずれメモリの空き容量がなくなりエラーが発生する可能性が高いので注意してください。


変数名について  
変数を定義するときには、変数名を分かりやすく命名することが求められます。

ですが、for文の初期化処理で定義する変数名は、慣習的にiやjなどの変数名が使われることが多いです。

もちろん、変数名に意味を持たせて、分かりやすい名前にしても問題ありませんが、for文のループ回数を指定するために使用する変数はiやjを使用してかまいません。


---

## 2重ループ

少し複雑なループ処理を見ていきましょう。

for文を2重（ネスト、入れ子）にした例です。


```php
<?php
for ($i = 0; $i < 2; $i++) {
    echo "\$iは{$i}です。<br>";
    for ($j = 0; $j < 2; $j++) {
        echo "\$jは{$j}です。<br>";
    }
}
```

結果

```text
$iは0です。
$jは0です。
$jは1です。
$iは1です。
$jは0です。
$jは1です。
```

---

このような結果になる理由がわかるでしょうか。

処理を追っていくと以下のようになります。


1. 外側のfor文の初期化：($i:0)
2. 外側のfor文の条件式判定：$i < 2でtrueになる
3. 出力処理：「$iは0です。」
4. 内側のfor文の初期化：($i:0, $j:0)
5. 内側のfor文の条件式判定：$j < 2 でtrueになる
6. 出力処理：「$jは0です。」
7. 内側のfor文の後処理：($i:0, $j:1)
8. 内側のfor文の条件式判定：$j < 2 でtrueになる
9. 出力処理：「$jは1です。」
10. 内側のfor文の後処理：($i:0, $j:2)
11. 内側のfor文の条件式判定：$j < 2 でfalseになる
12. 内側のfor文終了
13. 外側のfor文の後処理($i:1)
14. 出力処理：「$iは1です。」
15. 内側のfor文の初期化：($i:1, $j:0)
16. 内側のfor文の条件式判定：$j < 2 でtrueになる
17. 出力処理：「$jは0です。」
18. 内側のfor文の後処理：($i:1, $j:1)
19. 内側のfor文の条件式判定：$j < 2 でtrueになる
20. 出力処理：「$jは1です。」
21. 内側のfor文の後処理：($i:1, $j:2)
22. 内側のfor文の条件式判定：$j < 2 でfalseになる
23. 内側のfor文終了
24. 外側のfor文の後処理：($i:2)
25. 外側のfor文の条件式判定：$i < 2 でfalseになる
26. 外側のfor文終了

---

非常に長くなりましたが、１つ１つの処理は理解できるのではないでしょうか。

`$i`のループを外側のループ、$jのループを内側のループとして独立した処理として考えれば、難しくはありません。

このような処理も追えるようにしておきましょう。


---

## ループ制御

これまででfor文の基本的な使い方は一通り見ることができました。

あとはfor文を組み合わせたり、他の制御構文と組み合わせることで複雑な処理を実現させていきます。

そしてこのループ処理ですが、PHPではbreakとcontinueというキーワードを使って細かく制御することができます。


---

### break

まずはbreakの使い方を見ていきます。

breakは、任意のタイミングでループ処理を抜けることができるキーワードです。

まずは以下のプログラムを確認してください。

1~30までの合計を計算するプログラムです。


```php
<?php
$sum = 0;
for ($i = 1; $i < 30; $i++) {
    $sum += $i;
}
echo "合計は{$sum}です。";
```

結果

```text
合計は435です。
```

---

ここで、合計が100を超えた時点でループを終了し、何回目のループで100を超えたかを知りたいとします。

その場合、if文とbreakを使ってプログラムを以下のように書き換えます。

このようにすると、`$sum`が100を超えた時点で、`$i`が30を超えていなくてもループ処理が終了します。


```php
<?php
$sum = 0;
for ($i = 1; $i < 30; $i++) {
    $sum += $i;
    if ($sum > 100) {
        break;  // ループ終了
    }
}
echo "合計は{$sum}です。<br>";
echo "{$i}回のループです。<br>";
```

結果

```text
合計は105です。
14回のループです。
```

このように、ループの終了条件を満たしていない状態でループ処理を終了させたいときに使用するのがbreakになります。


---

### continue

続いて、もう一つのループ制御であるcontinueを見ていきます。

continueは、その周の処理をスキップするためのキーワードです。


先ほどと同様、1～30までの合計を出力するプログラムです。


```php
<?php
$sum = 0;
for ($i = 1; $i < 30; $i++) {
    $sum += $i;
}
echo "合計は{$sum}です。";
```

---

今度は、奇数の値だけ合計したい場合を考えます。

continueを使って以下のようにすると実現できます。


```php
<?php
$sum = 0;
for ($i = 1; $i < 30; $i++) {
    if ($i % 2 === 0) {
        continue;  // この周の処理を終了して次の周に移る
    }
    $sum += $i;
}
echo "奇数の合計は{$sum}です。";

```

結果

```text
奇数の合計は225です。
```

---

## while文

繰り返しの制御構文で、for文の他にもう一つwhile文があります。

構文は以下のようになります。


```text
while (条件式) {
    繰り返す処理
}
```

条件式がtrueの間だけ、処理を繰り返します。

初期化や後処理はありません。


---

例を見ていきましょう。以下のプログラムを実行してみます。


```php
<?php
$i = 0; // 初期化
while($i < 3) {
    echo "$i <br>";
$i++; // 後処理
}
```

結果

```text
0
1
2
```

for文と比較すると、初期化の処理がループの外で行われており、後処理がループの中で行われています。

この場合、後処理を書き忘れると無限ループになってしまいますので注意しましょう。

breakやcontinueは、whileの中でも使用することができます。


---

先ほどの例だけ見ると、for文とwhile文でできることはほとんど変わりません。どう使い分ければよいでしょうか。

明確な答えはありませんが、一般的には、

* あらかじめループの回数が決まっている場合はfor文
* ループの回数が決まっていない場合はwhile文

という使い分けをします。

あらかじめ回数が決まっていない、というのは例えばファイルを読み込んで1行ずつ処理する場合は、DBを読み込んでループで処理する場合などです。


---

## do ~ while文

while文には、もう一つ「do ～ while文」という書き方があります。

今までのループ文との違いは、先に処理を実行して後から条件判定をする、という部分です。


```php
do {

    繰り返す処理

} while (条件式);
```

---

例を見ていきましょう。


```php
<?php
$i = 0; // 初期化
do {
    echo "$i <br>";
    $i++;  // 後処理
} while($i < 3);
```

結果

```text
0
1
2
```

---

通常のwhile文で書いた場合と比較してみます。

結果が同じのため、違いが分かりにくいかもしれません。


```php
<?php
$i = 0; // 初期化
while($i < 3) {
    echo "$i <br>";
$i++; // 後処理
}
```

---

`$i`の値を変更して実行してみると、違いが分かります。

`$i`の値を100に変更し、違いを比較します。


```php
<?php
$i = 100; 
do {
    echo "$i <br>";
    $i++;  
} while($i < 3);
```

結果

```text
100
```

```php
<?php
$i = 100;  
while($i < 3) {
    echo "$i <br>";
    $i++;  
}
```

結果  
何も表示されない  

---

$iの値を100に変更したため、どちらのプログラムもwhileの条件式を満たさなくなりました。

しかしdo ~ whileは、無条件で最初一回は処理が実行されるようになっているため、100が出力されます。

つまり、違いとしては

* while文は条件によっては１度も処理が実行されない可能性がある
* do~while文はどんな条件でも必ず１度は処理が実行される

となります。


---

## まとめ

* 繰り返しの構文にはfor文とwhile文がある
* 繰り返しの回数が決まっている場合にはfor文を使う
* 繰り返しの回数が決まっていない場合にはwhile文を使う
* while文では通常のwhile文とdo~while文がある
* Whileは条件を処理の前に判定し、do~whileでは処理の後に判定する
* 繰り返し処理を制御する構文として、breakとcontinueがある

---

## 講義動画

[繰り返し](https://youtu.be/GddG2gXeGmM)

# UML

---

## 概要

オブジェクト指向の分析・設計・理解に役立つUMLについて学習します。

---

## UMLとは

Unified Modeling Language の略です。

オブジェクト指向における分析や設計で使用されるモデリング用の図の集まりです。

UMLに含まれる図のことを「ダイアグラム」と呼びます。

---

## UMLを学習することのメリット

UMLは業務で使用しないこともありますが、知っておくと以下のメリットがあります。

* 業務分析のツールとして使用できる
* オブジェクト指向の設計・理解の手助けとなる
* 図で視覚的にクラス間の関連性を表すことができ、既存システムの理解のスピードを
* デザインパターンを理解するのに必要

UMLは要件定義や機能設計を行う際に有効活用することで、コミュニケーションや理解を助ける役割があります。
図で視覚的に表現できるため、母国語の異なるエンジニア間でのコミュニケーションにも役に立ちます。

---

### UMLで使用されるダイアグラム一覧

* アクテビティ図
* オブジェクト図
* クラス図
* コミュニケーション図
* コンポーネント図
* コンポジット構造図
* シーケンス図
* 状態マシン図
* 相互作用概念図
* タイミング図
* 配置図
* パッケージ図
* ユースケース図

---

### UMLの分類

UMLの図は大きく2種類に分類できます。

* 構造の表記
  * クラスの関係性など、静的な関連性を表す図
* 振る舞いの表記
  * 処理の呼び出しの流れなど、動的な関連性を表す図

---

### 構造の記述

* オブジェクト図
* クラス図
* コンポーネント図
* コンポジット構成図
* 配置図
* パッケージ図

---

### 振る舞いの記述

* アクティビティ図
* コミュニケーション図
* シーケンス図
* 状態マシン図
* 相互作用概要
* タイミング図
* ユースケース図

---

* プログラムの流れや全体像を把握するためによく使用されるダイアグラム
  * クラス図
  * シーケンス図
* 業務分析でよく使用されるダイアグラム
  * ユースケース図
  * アクティビティ図

---

### クラス図とは

UMLの中で最も使用頻度の高いダイアグラムです。
クラスの仕様とクラス間の関連性を記述できるものです。
デザインパターンを理解するうえでクラス図は必須の知識です。

---

### クラスの書き方

長方形を3つの区画に分けます。
上にはクラス名を書きます。
真ん中の枠にはフィールド情報を書きます。
下の枠にはメソッド情報を書きます。
クラスフィールドやクラスメソッドの場合は、下線を入れます。
アクセス修飾子を指定することも可能です。

![picture 3](/images/468444fbc10ed482e29f02a78034278149e5833f6e6d444c0d7786da14fbfdfb.png)  

---

### 継承の書き方

継承関係を表した図です。
図の矢印は継承を指します。
上のクラスがスーパークラスで、下がサブクラスです。
抽象クラスや抽象メソッドは斜体で表記するのが一般的です。

サブクラスから見たスーパークラスのことを「特化」と呼びます。
スーパークラスから見たサブクラスのことを「汎化」と呼びます。

![picture 4](/images/db8f17d03bb39e5c70b4bc6aed709b0eedbde6ff4c8097626f85a4ed413daa87.png)  

---

### 実装（実現）の書き方

実装関係を表した図です。
インターフェースの場合、
継承ではなく実装という言葉で表現します。
実装は破線の矢印で表すのが一般的です。
上がインターフェースで、下が
実装しているクラスです。
インターフェースの場合は
\<\<interface\>\>や\<I\>などを表記します。

![picture 5](/images/5c44cf533335285cc29a5e9ac7b01839e58d850da5286b2ddcc9394b40d94181.png)  

---

### 集約の書き方

集約（アグリゲーション）を表した図です。
矢印は、オブジェクトを持っている側から持たれている側に向かいます。
図は、CarクラスのオブジェクトがTireクラスのオブジェクトを保持していることを示しています。

![picture 6](/images/7cef42907c55fafad9e4fb32ac72022da70da66942959092516e4dff74f8928e.png)  

---

### 関連の書き方

関連（知っている）ことを表した図
プログラム的には集約とほとんど同じ意味。

![picture 7](/images/ae9ed9a721fbca01b7329a6c704cc3ea01e4eccd98f27fecc721e7418063ad5c.png)  

---

### 使用

クラスを使用すること表すには、図の矢印を使用する。
ClassがUtilクラスを使用することを示している。

![picture 8](/images/b4908be9f67b5ad356eb0b15635eb408fd46d0210a8d3b10bab05135f0ae6456.png)  

関連とあまり大差ないと考えて良いでしょう。
基本的にUMLは自分が理解でき、かつ人に伝えることができれば厳密さにこだわる必要はありません。

---

### クラス図の有効活用

クラス図は、システムの詳細設計の際のクラス設計する場合に役立ちます。

既存のシステムの改修作業などでも役に立ちます。
既に存在しているクラスの全体像の把握をするのに役立つので有効に活用しましょう。

---

## シーケンス図

クラス図は、クラス間の静的な関係を表した図でした。

クラス図ではクラスの振る舞いの相互作用（どのメソッドからどのメソッドが呼ばれるかなど）は分かりません。

この振る舞いの相互作用を時系列で表したのがシーケンス図です。

シーケンス図の例

![picture 9](/images/6b9d9b6e271fa9b63abc3b88be258bea3c499dc12bafc2368d0ce3b1a689de63.png)  

---

## ユースケース図

ユースケース図は、ユーザーとシステム間のやり取り（相互作用）を記述すための図です。
ユーザーの属性毎に必要な機能を視覚的に表現できます。
要件定義を行う場合に役に立ちます。

ユースケース図の例

![picture 10](/images/bddefe4f0b06ad803a7bb0c0621ebb5ede9e8b63fdfcc3156b572e7588b3e0f5.png)  

---

## アクティビティ図

手続きや、メソッド（関数）のロジック、ビジネスプロセスなどのフローを記述するための技法。
フローチャートに似た役割を果たします。

アクティビティ図の例

![picture 11](/images/e3eba6608b856091307d0f1bcf076985ddea4b7ba86242fc1f6699246fbced23.png)  

---

## オブジェクト図

オブジェクトのある時点におけるスナップショットを表す図。
インスタンス図とも呼ばれます。
クラス図だけでは構造を把握するのが困難な場合に有効です。

オブジェクト図の例

![picture 12](/images/cc9bacb34ac436c2943d554d314612c35f6a2851a746730c845a7e816957039f.png)  

---

## コミュニケーション図

シーケンス図では、時系列でオブジェクト間のやり取りを記述しますが、コミュニケーション図では、時系列に関係なくオブジェクトを配置できます。
メッセージのやり取りをオブジェクトの関係を中心に表現できます。

コミュニケーション図の例

![picture 13](/images/0455568ce4f796b664796891c5b5c7ee459a6ac702f843aa0257fb6916cebc73.png)  

---

## コンポーネント図

コンポーネントの構造や、コンポーネント間の相互作用と表す図です。
そもそもコンポーネントとは、ソフトウェアの部品という意味ですがクラスとの明確な違いはありません。
一般には複数のクラスから構成されるシステムの一部をコンポーネンと呼びます。
システムをいくつかの部品に分割し、その関係性や構造を示す場合に使用します。

コンポーネント図の例

![picture 14](/images/5f14d712bba78fc6d59cb74b1031b07da777255aa0c06810daf4057e06806652.png)  

---

## コンポジット構造図

複数のクラスを包括するようなクラス、コンポーネントにおいて、その内部構造を表現するための図です。

コンポジット構造図の例

![picture 15](/images/7878dc1262be5c9178802be5adce80b5995ce4105430d474ce28b08de23fc20c.png)  

---

## 相互作用概要図

相互作用概要図は、アクティビティ図とシーケンス図を合体させたものです。
アクティビティ図の中のアクテビティを、シーケンス図に置き換えたもの、もしくはアクティビティ図の記法で制御フローを分割したシーケンス図。

---

## タイミング図

タイミングは、オブジェクトの状態が変化するタイミングを表すことを重視した図です。

---

## 配置図

配置図は、システムの物理的なレイアウトを示す図です。
ソフトウェアのどの部分がハードウェアのどの部分で動作するかを示す。

---

## パッケージ図

パッケージとは、クラスをグルーピングするための仕組みです。
言語によっては名前空間とも呼ばれます。
パッケージ図は、パッケージ（名前空間）、およびパッケージ間の依存関係を表す図です。
規模が大きいシステムでは、パッケージ間の依存関係を把握するのに便利です。

---

## ここまでのまとめ

* クラス図・シーケンス図・ユースケース図・アクティビティ図は使われる場面や役に立つ場面も多いので知っておくと良いでしょう。
* UMLはクラスの構造や処理の流れを理解するためのツール、人に説明するためのツールとして活用すると便利です。
* ほとんど使われない図もあるので、全部覚える必要はありません。（興味がある人は調べて勉強してみてください。）

---

## UMLが作成できるサービス・ツール

[cacoo](https://cacoo.com/ja/)

無料だと機能が限られるが、ブラウザ上から様々な図が描けるWebサービス。

[astah](http://astah.change-vision.com/ja/)

UML等の図が作成できるデスクトップアプリ。
現在は無料だとビューアーしか使用できない。

その他

eclipseなどのIDEにはプラグインも多く提供されています。
色々試して使いやすいツールを探しましょう。

---

## PlantUML

テキスト（コード）からUMLのダイアグラムを作成することができるツールです。

公式サイトにて作成したUMLを画像ファイルでエクスポートできます。

VS CodeやIDEの拡張機能もあります。
VS Codeの場合、Markdown Preview Enhancedの拡張機能を入れておくことで、プレビューでそのまま確認することができます。

[公式サイト](https://plantuml.com/ja/)

---

### クラス図のサンプル

```text
@startuml class

class Class {
    {static} staticField
    field
    {static} staticMethod()
    method1()
    method2()
}

@enduml
```

以下のように表示される。

![picture 16](/images/f5dafdcf61d19982e3ac30f4bca19ec61c91c81bf729e30b4ed3fcafb542ba9d.png)  

---

### クラス図・継承のサンプル

```text
@startuml superSub

abstract class SuperClass
SuperClass <|-- SubClass
SuperClass : {abstract} abstractMethod()
SubClass : method()

@enduml
```

![picture 17](/images/08f9f8fa3ddb92af345171860534f138fb0558eee479ca5f33f6896625864bd8.png)  

---

### クラス図・実装のサンプル

```text
@startuml Interface

interface  Interface
Interface <|.. Class
Interface : {abstract} method()
Class : method()

@enduml
```

![picture 18](/images/eaecc932af94717c6d76a0b3f67d4c491314512cb7b6aae0d5ea726c8d12db9c.png)  

---

### クラス図・集約のサンプル

```text
@startuml Aggregate

Car o- Tire

@enduml
```

![picture 19](/images/28533da6ef6caa128e41fc9c72d912554cbe93cd0cc5616b1b3b980b9ee7d558.png)  

---

### クラス図・関連のサンプル

```text
@startuml Relation

class Car
class Tire
Car -> Tire

@enduml
```

![picture 20](/images/1da954526c0da30be6fa529bb76db7156e7aacdd2c375c1e4332ed7ec3a992a3.png)  

---

### クラス図・使用のサンプル

```text
@startuml USE

class Class
class Util
Class .> Util

@enduml
```

![picture 21](/images/75fdef92f4726827c224cfbc860b9b783225ce6b5b7361e3114c25222dd4c0f7.png)  

---

### クラス図・ポリモーフィズムのサンプル

```text
@startuml Charactor2
プレイヤー o- キャラクター
キャラクター <|-- 戦士
キャラクター <|-- 魔法使い
キャラクター <|-- 勇者
class プレイヤー {
    play(キャラクター ch)
}
キャラクター : 戦う()
戦士 : 戦う()
魔法使い : 戦う()
勇者 : 戦う()
@enduml
```

![picture 22](/images/500feb110d21abcca0c3486cf8d77bc15a02c5bdd83846bd034046bcae48f0bb.png)  

---

### シーケンス図のサンプル

```text
@startuml sikensu

VIEW -> Controller: get
Controller -> Model: getData
Controller <-- Model
VIEW <-- Controller

@enduml
```

![picture 23](/images/046f22a23907f6a955743946e388f97c4f660cb60aec2a4147db59b04c463094.png)  

---

### アクティビティ図のサンプル

```text
@startuml activity

|会員顧客|
start
:ログインする;
:商品を検索する;
|Webサイト|
:検索結果を表示する;
|会員顧客|
:検索結果を確認する;
stop

@enduml
```

![picture 24](/images/8c0daefb304c795e2d6e5fc16106cf5fa13fb88f78f72aa2f579244b3217b7f0.png)  

---

### ユースケーズのサンプル

```text
@startuml

actor 一般顧客
actor 会員顧客
rectangle 商品購入 {
一般顧客 --> (会員登録する)
一般顧客 --> (商品を検索する)
会員顧客 --> (商品を検索する)  
会員顧客 --> (商品を注文する)
会員顧客 --> (購入履歴を確認する)
}

@enduml
```

![picture 25](/images/596c5fc4e8efea07fdad8411b18b8f3ce07161e15b4bab72da12facf66b2289c.png)  

---

## 演習

PlantUMLの記法を使い、オブジェクト指向の演習のソースコードのクラス図を作成してください。

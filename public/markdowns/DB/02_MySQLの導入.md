# MySQL入門

---

## MySQL

MySQLはオープンソースデータベースで、無償で利用することが可能です。

Webアプリケーション、特にPHPを使ったWebアプリケーションなどで多く採用されています。

[公式サイト](https://www.mysql.com/jp/)

---

## MariaDB

MySQLから派生して作成されたデータベースでMariaDBと呼ばれるDBがあります。

XAMPP環境を導入した場合、厳密にはMySQLではなくMariaDBが導入されます。

両者にはいくつかの違いがありますが、このテキストの学習範囲においては機能的に違いはありません。

そのため支障がない限りこれ以降はMySQLとMariaDBは同じものとして話を進めます。

---

## インストール

### XAMPPによる導入

XAMPP（またはMAMP）環境を導入している場合、PHP環境とセットでMySQL（MariaDB）の環境もインストールされているので、新たにデータベースをインストールする必要はありません。

XAMPPがまだインストールできないできていない場合は、XAMPPの公式サイトからダウンロードし、インストールを行ってください。

[XAMPPダウンロードサイト](https://www.apachefriends.org/jp/index.html)

### MySQL単体のインストール

このテキストではXAMPP環境を前提として解説しますが、個別で導入したい場合は公式サイトよりダウンロードして各自でインストールしてください。

[MySQLダウンロードサイト](https://www.mysql.com/jp/downloads/)

---

## MySQLへの接続

### MySQLのサービス起動

MySQLを利用するには、サービスを起動して、ツールからMySQLに接続する必要があります。

ここではMySQLの起動はXAMPPを利用することを前提とします。

MySQLを単体でインストールしている場合は別途サービスの起動方法を調べてサービスを起動しておいてください。

XAMPPではコントロールパネルからMySQLのサービスを起動できます。
MySQLを使用する場合は、ApacheとMySQLの「Start」ボタンを押下し、ApacheとMySQLのサービスを起動させておいてください。

![picture 7](/images/4aca16b3a6eb88cbb12e890178f43b8722babfecce42fac25848d58902759bcf.png)  

DBに接続するにはいくつかの方法があります。

ここではphpMyAdminによる接続と、コマンドラインからによる2種類の方法を紹介します。

---

## phpMyAdminによる接続

XAMPPの場合、phpMyAdminというWebアプリからDBを操作することが可能です。

以下の手順から起動できます。

1. XAMPPのコントロールパネルを起動
2. ApacheとMySQLを起動（Startボタン押下）
3. MySQLの「Admin」ボタン押下

phpMyAdminというMySQL操作用のGUIツールが起動します。

左側のツリーから操作対象のDBを選択して操作できます。

![picture 8](/images/b085717a2d87f8a7f8465fc71caa2223bb0535cc8e77a15112f8ffb1646a0c87.png)  

---

## コマンドによる接続

コマンドの場合は以下の手順で接続できます。

1. コマンドラインツール（コマンドプロンプト、PowerShell、VS Codeのターミナルなど）を起動
2. cdコマンドでmysql.exeのあるフォルダに移動
3. mysqlコマンドで接続

### 1. コマンドラインツール（コマンドプロンプト、PowerShell、VS Codeのターミナルなど）を起動

コマンドによる操作を行うツールをコマンドラインツール(CLI)と呼びます。

Windowsの場合は以下のようなツールが該当します。

* コマンドプロンプト
* Windows PowerShell
* Windows Terminal
* VS Codeのターミナル

いずれかのツールを起動します。

---

## コマンドによる接続

### 2. cdコマンドでmysql.exeのあるフォルダに移動

cdコマンドでカレントディレクトリをmysql.exeのある場所に移動します。

XAMPPをデフォルトのパスにインストールした場合は以下になります。

mysql.exeの場所が異なる場合はそれぞれの環境に合わせて移動してください。

```bash
cd C:¥xampp¥mysql¥bin
```

---

### 3. mysqlコマンドで接続

mysql.exeのあるフォルダに移動した後は、以下のコマンドから接続可能です。

rootユーザーでmysqlに接続するという意味になります。

```bash
> mysql –u root
```

なお、PowerShell（VS Codeのターミナル）から接続する場合は以下のように先頭に「.¥」をつける必要がる場合があります。

```bash
> .¥mysql –u root
```

指定したユーザーにパスワードが設定されている場合は「-p」をつけて、入力後にパスワードを入力します。

XAMPPの場合、デフォルトではrootユーザーにはパスワードは設定されていませんが、他の環境では設定されている場合があります。

```bash
> mysql –u ユーザー名 -p
```

※WindowsのXAMPPの場合は確認した限りデフォルトではパスワードは設定されていない。

MAMPの場合はrootユーザーにrootのパスワードが設定されている。

---

接続に成功すると以下のように表示されます。

※表示のされ方は環境やバージョンによって多少異なります。

左側にMySQLかMariaDBの表記が出ていればOKです。

MariaDBの場合

```bash
MariaDB [(none)]> 
```

MySQLの場合

```bash
MySQL>
```

---

### データベース一覧の確認

SQL文やMySQL特有のコマンドが入力できるようになります。

試しにデータベースの一覧を確認するコマンドを入力してみましょう。

一覧が確認できればOKです。

```bash
MariaDB [(none)]> show databases;
```

```bash
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| phpmyadmin         |
| test               |
+--------------------+
```

---

### mysqlの接続を切る

MySQLへの接続を切り、通常のコマンドラインに戻りたい場合は「quit」または「exit」コマンドを使用します。
接続を切った後、再度MySQLに接続するには、再度「mysql –u」コマンドを実行して接続します。

```bash
-- mysqlの接続を切る
> quit
-- または
> exit
```

---

## 環境変数の設定

コマンドプロンプトやターミナル上からMySQLを操作する場合、毎回mysql.exeがあるフォルダまで移動するのは面倒です。

環境変数「Path」に、mysql.exeが存在するパスを追加しておくことで、「cd」コマンドでカレントディレクトリを移動しなくてもmysqlコマンドが使用できるようになります。

環境変数の設定は以下の手順で実施してください。

1. エクスプローラの起動（Windowsキー + E）
2. PCを右クリック ⇒ プロパティを選択
3. 設定画面で「システム詳細設定」を選択
4. システムプロパティの「環境変数」を選択
5. システムの環境変数の「Path」を選択して「編集」を選択
6. 新規を押下
7. mysql.exeがあるフォルダ（例：C:¥xampp¥mysql¥bin）を追加してOK押下
8. OKを押下して環境変数、システムプロパティを閉じる

---

### 環境変数設定の確認

環境変数の設定がうまくいっているか確認するには、コマンドプロンプトを再起動し、以下のコマンドを入力します。

```bash
> mysql –-version
```

バージョン情報が出力されれば設定がうまくいっています。

```text
C:\xampp\mysql\bin\mysql.exe  Ver 15.1 Distrib 10.4.20-MariaDB, for Win64 (AMD64), source revision c7ee039d36f69f24fb3b1c422fcff8dbf974e3eb
```

設定が完了すれば、いつでもmysqlコマンドが使用でき、コマンドからmysqlへ接続できる状態になります。

---

## ユーザーの作成

MySQLではDBに接続する際にはユーザーを指定する必要があります。
デフォルトでは「root」ユーザーでのみ接続ができます。
開発をする際には多くの場合root以外のユーザーを作成します。
ここでは「axizuser」というユーザーを新たに作成してみます。
ユーザーの作成はMySQLに接続された状態で行う必要があるため、まずはrootユーザーでMySQLに接続します。

```bash
> mysql –u root
```

ユーザーを作成するには以下のSQLを実行します。

```sql
CREATE USER axizuser@localhost IDENTIFIED BY 'axiz';
```

このコマンドでは「axizuser」というユーザーを、パスワード「axiz」で作成しています。
@の後ろは、接続可能なホスト名を表しており、localhostと指定すると、自身のサーバーからのみ接続可能となります。
なお、SQLでは大文字と小文字は区別されませんが、パスワードの「axiz」の部分（'で囲われた部分）は大文字と小文字を区別するので注意して下さい。

---

ユーザーの作成が完了したら一度MySQLの接続を切ります。

```bash
> quit
```

その後、先ほど作成したaxizuserを指定して接続をします。
axizuserではパスワードを設定したので、-pのオプションを指定します。

```bash
> mysql -u axizuser -p
```

パスワードの入力を求められるので、「axiz」を入力します。
※画面上パスワードは表示されませんが、入力はされています。
接続に成功すればユーザーの作成はうまくいっています。
これから先の内容は「axizuser」でmysqlへ接続するようにしてください。

---

## データベースの作成

MySQLでデータを格納する場合、まずはMySQL内に作業用のデータベースを作成する必要があります。
ここでのデータベースは、テーブルなどのデータベース内のオブジェクトを格納する領域としてのデータベースです。
phpMyAdminを使用することでGUI操作が可能です。
コマンドによる操作も可能です。
それぞれの方法を解説します。

### phpMyAdminの場合

左側のツリーから「新規作成」を選択し、データベース名を入力して「作成」をクリックします。
左のツリーに「axizdb」が表示され、選択することでデータベースに対する操作が可能になります。
データベース名は任意ですが、このテキストでは「axizdb」として話を進めます。

![picture 9](/images/ca71a729960a01ecd6e001c9dcffd107ad506cfdf66c569b11cd66ae3a8a7dd7.png)  

---

### コマンドの場合

コマンドからデータベースを作成する場合は以下のようにします。
「--」から始まる分はコメントです。実際に入力する必要はありません。
なお、データベースの操作コマンド（とSQL）は大文字と小文字を区別しないので、大文字小文字はテキストに合わせる必要はありません。

```sql
-- データベースの作成
> CREATE DATABASE axizdb;
-- 確認
> show databases;
```

コマンドの場合、どのデータベースを使用するかをuseコマンドで指定してあげる必要があります。

指定すると、左側に表記されている（none）が、選択したデータベースになります。

```bash
-- データベースの選択
MariaDB[(none)]> use axizdb;
MariaDB[axizdb]>  
```

---

## 操作方法まとめ

MySQLをコマンドで操作する場合のコマンドをまとめます。
これらのコマンドはSQLとは関係なく、MySQLをコマンドから操作する場合にのみ有効なコマンドです。

接続

```bash
> mysql -u ユーザー名 -p
```

データベースを指定することも可能です。

```bash
> mysql -u ユーザー名 -D データベース名 -p
```

切断

```bash
> quit
or
> exit
```

---

## 操作方法まとめ

データベース一覧表示

```bash
> show databases
```

データベースの切り替え

```bash
> use データベース名
```

---

## 講義動画

[DBの導入](https://youtu.be/3KgYiq2vGQ4)

[MySQL概要](https://youtu.be/lktBfnHBg1o)

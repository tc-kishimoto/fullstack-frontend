# Java単元課題6

---

[リポジトリ](https://github.com/tc-kishimoto/Java-RPN)

## 基本課題

### 概要

課題は、数式をパースして逆ポーランド記法に変換し、計算を行うプログラムの実装です。
「1 + 2」など普段の生活で使用している数式は中置記法と呼ばれるもので、演算子がオペランドの真ん中にきます。
逆ポーランド記法は「1 2 +」のように演算子がオペランドの後にきます。
逆ポーランド記法は計算の優先順位を上げる「()」が不要などの利点があります。
今回は数式を、数値や演算子をノードの値としてもった二分木に展開することで、逆ポーランド記法への変換を行います。
そして展開した二分木を利用して、実際に計算結果まで求めます。
数式 → 二分木 → 逆ポーランド記法の流れのサンプルとして、ExprTreeSampleが含まれているので参考にしてください。

### 実装内容

実装内容として、以下の要件を満たしてください。

* 四則演算（+ - * /）の計算ができること
* 入力値として1桁の整数の計算ができること
* 計算時のオーバーフローは考慮しなくてよい
* 数式内のスペースは考慮しなくてよい

ユニットテスト

JUnitのテストケースがプロジェクトに含まれています。
全てのテストケースをパスしてください。

### 実装対象と実装方針

実装の対象は以下の2つとなります。

* jp.co.example.parser.MathExpParser
  * parseメソッド
* jp.co.example.struct.traverse.CalcStrategy
  * executeメソッド
  * getResultメソッド

※ まずは修正対象のクラスだけでなく全体のプログラムを把握しましょう。

数式を二分木の形にパースします。
以下のようなイメージになるようpaseメソッドを実装してください。

![picture 8](../../images/cbb5bfc6e0e5bb57ad938ccfbd2238c2b4e85b46a557adfc4fc7b6841724952e.png)  

記号（＋、－、×、÷）にはOpNodeクラスを使用します。

![picture 9](../../images/140d87304f9a6c915f096fd8fd248578f75921959eea49887d312152017c6427.png)  

数値にはIntegerNodeクラスを使います。

![picture 10](../../images/5f4f98422623d88c1b6ba92b994be19bfacace72cccb93a5473801640a9c44cf.png)  

各Nodeのフィールド（leftおよびright)に子Nodeへの参照を設定することで各ノードを繋ぎます。

![picture 11](../../images/6d567b2ee8a53332bbfac817d8639810b3fc9d4308b416d09a7e61fa60a07209.png)  

パースの手順は何通りもありますが、一番優先順位の低い演算子を基準にパースする方法が考え方としては簡単です。

![picture 12](../../images/282cecb6a1fc4fb1c35793f449871d02332932793f0c87e3d303324775c5eb42.png)  

![picture 13](../../images/3d0fdd260572ef6388299dfa0ab6ab59c84b0e9063e97e2288493049808cf5af.png)  

CalcStrategyクラスはTreeTraverseクラスと合わせて、二分木のパースされた情報を基に計算を行っています。

TreeTraverseクラスのpostOrderメソッドでは以下の処理を行っています。

* 左下にNodeがあるか確認
  * →左下にNodeがあればそのNodeに対して1～3を実施
* 右下にNodeがあるか確認
  * →右下にNodeがあればそのNodeに対して1～3を実施
* 今のNodeに引数で渡されたNodeStrategy（今回はCalcStrategy）のexecuteを実行

以降の処理になるようexecuteメソッド、getResultメソッドを実装してください。

イメージは以下になります。
一番上のNodeを検査対象のNodeとして処理を開始。
左下にNodeがあれば左下のNodeを検査対象として再度自身（postOrder）を呼び出します。

![picture 14](../../images/a98783219abaf7419b3c71410501e13030771d08fc2a1ab5ce46438499d588a5.png)  

次の検査対象は『×』のNode
左下にNodeがあれば左下のNodeを検査対象として再度自身（postOrder）を呼び出します。

![picture 15](../../images/cf72dec8965ce245c24d45e5005cdfdd86f889701c4a0f25aeb37cc15d37962f.png)  

次の検査対象は『3』のNode
左下、右下、ともにNodeがないのでexecute（実装対象）を実行します。
このとき、『3』をstackに積んでください。

![picture 16](../../images/0b99d0fe4cc5771304665b5808b6e3fd573c9dc50067b2a309701f0d5844ad0b.png)  

次の検査対象は戻って『×』のNode
右下にNodeがあれば右下のNodeを検査対象として再度自身（postOrder）を呼び出します。

![picture 17](../../images/0784979acaec82e685e96738b84bc754e61d63f789ff34424424f460c98ef5a2.png)  

次の検査対象は『5』のNode
左下、右下、ともにNodeがないのでexecute（実装対象）を実行します。
このとき、『5』をstackに積んでください。

![picture 18](../../images/70652b1de2e9ed34adb3938644e62545b4448927bc4bd81cf526e05aadcc0b7e.png)  

次の検査対象は戻って『×』のNode
1、2が終わっているのでexecute（実装対象）を実行します。
このとき、stackから上の二つの情報を取り出し、掛け算をして積みなおします。

![picture 19](../../images/0d02946fe5e9dd71bf2b8874f078932cd3721532f7b5edd2a11b5f317a379af3.png)  

次の検査対象は戻って『＋』のNode
右下にNodeがあれば右下のNodeを検査対象として再度自身（postOrder）を呼び出します。

![picture 20](../../images/92f280b336d43f761f90448ce26dd61530d4c2dc15af854c4dd31d9f93e24a2f.png)  

次の検査対象は『2』のNode
左下、右下、ともにNodeがないのでexecute（実装対象）を実行します。
このとき、『2』をstackに積んでください。

![picture 21](../../images/b40b44a9d607a4f7a22a14e293deb164f9241433a24bf1dd4dec123331f3cf30.png)  

次の検査対象は戻って『＋』のNode
1、2が終わっているのでexecute（実装対象）を実行します。
このとき、stackから上の二つの情報を取り出し、足し算をして積みなおします。

![picture 22](../../images/2a1f6ea87a1631f7a664be89b8ace773c4421ad921d72fccf515e768c8249546.png)  

全てのNodeの処理を終えました。
最後にgetResult（実装対象）が呼び出されますので、stackに残っている値を返却します。

![picture 23](../../images/21fc02a08c7af96187a9911d3c1f51a7d3a072be38b01deb19d334d6d5826306.png)  

### 実装上の注意点

課題を進める上でインターネットによる検索は問題ありません。
逆ポーランド記法や、実際にそこから計算する方法など調べる必要があると思います。

またプログラムの中には以下を記述してください。

* 参考にしたサイトのURL
* 実装内容に対するコメント

コメントを書く上では、How（どのような処理）ではなく、What（何をしている処理）またはWhy（なぜそういう実装なのか）を書くように心がけてください。

実行イメージ

以下は課題に期待される正しい挙動です。

![picture 24](../../images/83c5c12bd68489e83d8d30c7de58ade08bd2ad5b3bcc5f6079ca6317d72a5ad4.png)  

↓

![picture 25](../../images/554fa6442a8cfbf5eba85e75cdf27263361391cd1657478275fea05523ebb837.png)  

---

## 発展課題

### 概要

基本課題で作成したアプリケーションの機能を拡張します。

以下の追加要件を実装してください

* 剰余算（%）に対応
* () の含まれる数式に対応
* 2桁以上の数値に対応
* ユニットテスト
  * JUnitのテストケースがプロジェクトに含まれています
  * コメントアウトされているテストケースのコメントを外したうえで、全てのテストケースをパスしてください

以下は課題に期待される正しい挙動です。

![picture 26](../../images/280b58e54754974274463f641ce2a1f0ca25936c01899c9394a4df579baaafd1.png)  

↓

![picture 27](../../images/6ef07af87b5c9ba3dc09e1353a2839b297cd4acda9d827845184a2455aa65fae.png)  
